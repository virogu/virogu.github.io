

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/resources/img/logo.png">
  <link rel="icon" href="/resources/img/logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="未知">
  <meta name="keywords" content="">
  
    <meta name="description" content="ART ART 功能 预先 (AOT) 编译 垃圾回收优化 开发和调试方面的优化   ART GC   Hook 基本流程 使用示例   Proguard 规则 公共模板 常用的自定义混淆规则 aar中增加独立的混淆配置 检查混淆和追踪异常   架构 MVC MVP MVVM   Jetpack 架构 使用示例   NDK 开发 JNI 基础 数据类型 String 字符串函数操作 常用 JNI">
<meta property="og:type" content="article">
<meta property="og:title" content="Android扩展知识点">
<meta property="og:url" content="http://virogu.github.io/2023/08/24/docs/android/zhi-shi-hui-zong/android-kuo-zhan-zhi-shi-dian/index.html">
<meta property="og:site_name" content="半漠清风">
<meta property="og:description" content="ART ART 功能 预先 (AOT) 编译 垃圾回收优化 开发和调试方面的优化   ART GC   Hook 基本流程 使用示例   Proguard 规则 公共模板 常用的自定义混淆规则 aar中增加独立的混淆配置 检查混淆和追踪异常   架构 MVC MVP MVVM   Jetpack 架构 使用示例   NDK 开发 JNI 基础 数据类型 String 字符串函数操作 常用 JNI">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCwLhGyLdicyLzgUDKFTZVt1OgU6iaSx2IUwnygzmQzW7Renaa8hmQ62cQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCicNvEVMO9vDgukUR29Z1DCacZJwmmH1EEb7gUOZmDxolWexP01O8jfg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCOq89MLQX4UM3dgBTQfU72desHb1XbOWRQZINnXOCCdZCuicUiaTHhtEg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCLVgibsuVQFguBI8FBdZibLNfpvbpd6njkdGWdyR2UL6TzMOhKHFqLC0Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCMygIDD6xo5djkq6Y3jZo53sT2A4kKNaz8JEVRwmUnTmcAwJm0pZVWg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
<meta property="og:image" content="https://developer.android.google.cn/topic/libraries/architecture/images/final-architecture.png">
<meta property="og:image" content="https://img-blog.csdn.net/20161021101447117?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center">
<meta property="article:published_time" content="2023-08-24T12:00:00.000Z">
<meta property="article:modified_time" content="2023-08-24T12:00:00.000Z">
<meta property="article:author" content="Virogu">
<meta property="article:tag" content="Android">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCwLhGyLdicyLzgUDKFTZVt1OgU6iaSx2IUwnygzmQzW7Renaa8hmQ62cQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1">
  
  
    <meta name="referrer" content="no-referrer-when-downgrade">
  
  
  <title>Android扩展知识点 - 半漠清风</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"virogu.github.io","root":"/","version":"1.9.5-a","typing":{"enable":true,"typeSpeed":70,"cursorChar":"","loop":false,"scope":["home"]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0">
<style>.github-emoji { position: relative; display: inline-block; width: 1.2em; min-height: 1.2em; overflow: hidden; vertical-align: top; color: transparent; }  .github-emoji > span { position: relative; z-index: 10; }  .github-emoji img, .github-emoji .fancybox { margin: 0 !important; padding: 0 !important; border: none !important; outline: none !important; text-decoration: none !important; user-select: none !important; cursor: auto !important; }  .github-emoji img { height: 1.2em !important; width: 1.2em !important; position: absolute !important; left: 50% !important; top: 50% !important; transform: translate(-50%, -50%) !important; user-select: none !important; cursor: auto !important; } .github-emoji-fallback { color: inherit; } .github-emoji-fallback img { opacity: 0 !important; }</style>
<link rel="alternate" href="/atom.xml" title="半漠清风" type="application/atom+xml">
</head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 40vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>半漠清风</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle">Android扩展知识点</span>
          
        </div>

        
          
  <div class="mt-3">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-author" aria-hidden="true"></i>
        未知
      </span>
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2023-08-24 20:00" pubdate>
          2023年8月24日 晚上
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          20k 字
        
      </span>
    

    

    
    
      
        <span id="busuanzi_container_page_pv" style="display: none">
          <i class="iconfont icon-eye" aria-hidden="true"></i>
          <span id="busuanzi_value_page_pv"></span> 次
        </span>
        
      
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar category-bar" style="margin-right: -1rem">
    





<div class="category-list">
  
  
    
    
    
    <div class="category row nomargin-x">
      <a class="category-item 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="Android"
        id="heading-e84e30b9390cdb64db6db2c9ab87846d" role="tab" data-toggle="collapse" href="#collapse-e84e30b9390cdb64db6db2c9ab87846d"
        aria-expanded="true"
      >
        Android
        <span class="list-group-count">(34)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-e84e30b9390cdb64db6db2c9ab87846d"
           role="tabpanel" aria-labelledby="heading-e84e30b9390cdb64db6db2c9ab87846d">
        
        
          
          
  <div class="category-post-list">
    
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="JNI"
        id="heading-4ceb3f5b846fa736acaada4c2f37a419" role="tab" data-toggle="collapse" href="#collapse-4ceb3f5b846fa736acaada4c2f37a419"
        aria-expanded="false"
      >
        JNI
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-4ceb3f5b846fa736acaada4c2f37a419"
           role="tabpanel" aria-labelledby="heading-4ceb3f5b846fa736acaada4c2f37a419">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/30/docs/android/jni/jni-zhong-da-yin-androidlog/" title="JNI中打印AndroidLog"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">JNI中打印AndroidLog</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="View"
        id="heading-4351cfebe4b61d8aa5efa1d020710005" role="tab" data-toggle="collapse" href="#collapse-4351cfebe4b61d8aa5efa1d020710005"
        aria-expanded="false"
      >
        View
        <span class="list-group-count">(12)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-4351cfebe4b61d8aa5efa1d020710005"
           role="tabpanel" aria-labelledby="heading-4351cfebe4b61d8aa5efa1d020710005">
        
        
          
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/27/docs/android/view/edittext/" title="EditText属性配置"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">EditText属性配置</span>
        </a>
      
    
      
      
        <a href="/2023/08/27/docs/android/view/textview-shu-xing/" title="TextView属性"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">TextView属性</span>
        </a>
      
    
      
      
        <a href="/2023/08/27/docs/android/view/textview-xian-zhi-shu-ru-nei-rong/" title="TextView限制输入内容"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">TextView限制输入内容</span>
        </a>
      
    
      
      
        <a href="/2023/08/27/docs/android/view/radiobutton/" title="RadioButton属性"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">RadioButton属性</span>
        </a>
      
    
  </div>

          
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="CustomView"
        id="heading-e4ab316ef21a84809676e0065a208779" role="tab" data-toggle="collapse" href="#collapse-e4ab316ef21a84809676e0065a208779"
        aria-expanded="false"
      >
        CustomView
        <span class="list-group-count">(4)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-e4ab316ef21a84809676e0065a208779"
           role="tabpanel" aria-labelledby="heading-e4ab316ef21a84809676e0065a208779">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/29/docs/android/view/customview/animeview/" title="AnimeView"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">AnimeView</span>
        </a>
      
    
      
      
        <a href="/2023/08/29/docs/android/view/customview/customradiogroup/" title="自定义RadioGroup"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">自定义RadioGroup</span>
        </a>
      
    
      
      
        <a href="/2023/08/29/docs/android/view/customview/ipeditortext/" title="IP输入框控件"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">IP输入框控件</span>
        </a>
      
    
      
      
        <a href="/2023/08/29/docs/android/view/customview/verticalseekbar/" title="垂直SeekBar,VerticalSeekBar"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">垂直SeekBar,VerticalSeekBar</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="RecycleView"
        id="heading-125499de79f8c3dbffe1583ac986cca3" role="tab" data-toggle="collapse" href="#collapse-125499de79f8c3dbffe1583ac986cca3"
        aria-expanded="false"
      >
        RecycleView
        <span class="list-group-count">(4)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-125499de79f8c3dbffe1583ac986cca3"
           role="tabpanel" aria-labelledby="heading-125499de79f8c3dbffe1583ac986cca3">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/28/docs/android/view/recycleview/paging3-xiang-guan/" title="Paging3相关"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Paging3相关</span>
        </a>
      
    
      
      
        <a href="/2023/08/28/docs/android/view/recycleview/recycleview-selection/" title="RecycleView多选功能示例，RecycleView-Selection"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">RecycleView多选功能示例，RecycleView-Selection</span>
        </a>
      
    
      
      
        <a href="/2023/08/28/docs/android/view/recycleview/recyclerview-ge-xing-hua-she-zhi/" title="RecyclerView个性化设置"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">RecyclerView个性化设置</span>
        </a>
      
    
      
      
        <a href="/2023/08/28/docs/android/view/recycleview/recycleview-hua-dong-shan-chu/" title="RecycleView滑动删除"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">RecycleView滑动删除</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="其他"
        id="heading-0d98c74797e49d00bcc4c17c9d557a2b" role="tab" data-toggle="collapse" href="#collapse-0d98c74797e49d00bcc4c17c9d557a2b"
        aria-expanded="false"
      >
        其他
        <span class="list-group-count">(11)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-0d98c74797e49d00bcc4c17c9d557a2b"
           role="tabpanel" aria-labelledby="heading-0d98c74797e49d00bcc4c17c9d557a2b">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/androidsamples/" title="AndroidSamples"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">AndroidSamples</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/contentresolver/" title="ContentResolver"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">ContentResolver</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/android-mu-lu-wen-jian-jian-xi/" title="Android目录文件简析"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Android目录文件简析</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/webrtc-bian-yi/" title="WebRTC编译"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">WebRTC编译</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/cha-kan-apk-qian-ming-xin-xi/" title="查看Apk签名信息"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">查看Apk签名信息</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/an-zhuo-za-ji/" title="安卓杂记"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">安卓杂记</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/xi-tong-xin-xi-huo-qu/" title="系统信息获取"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">系统信息获取</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/xi-tong-guang-bo/" title="系统广播"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">系统广播</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/qing-qiu-hu-lue-dian-chi-you-hua/" title="请求忽略电池优化"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">请求忽略电池优化</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/xi-tong-ti-gong-de-activity/" title="系统提供的Activity"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">系统提供的Activity</span>
        </a>
      
    
      
      
        <a href="/2023/08/26/docs/android/qi-ta/ruan-jian-pan-xiang-guan-cao-zuo/" title="软键盘相关操作"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">软键盘相关操作</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="工具类"
        id="heading-a72d8a4ca7a7e4637cefc70e4ba0b248" role="tab" data-toggle="collapse" href="#collapse-a72d8a4ca7a7e4637cefc70e4ba0b248"
        aria-expanded="false"
      >
        工具类
        <span class="list-group-count">(2)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-a72d8a4ca7a7e4637cefc70e4ba0b248"
           role="tabpanel" aria-labelledby="heading-a72d8a4ca7a7e4637cefc70e4ba0b248">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/25/docs/android/gong-ju-lei/tu-pian-cao-zuo-xuan-zhuan-suo-fang-xiang-hu-zhuan-hua/" title="常用图片操作（旋转、缩放、相互转化等）"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">常用图片操作（旋转、缩放、相互转化等）</span>
        </a>
      
    
      
      
        <a href="/2023/08/25/docs/android/gong-ju-lei/an-zhuo-jing-mo-an-zhuang-ruan-jian/" title="安卓静默安装软件"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">安卓静默安装软件</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem 
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="知识汇总"
        id="heading-4514693aa4a351141269d9ac95460bcf" role="tab" data-toggle="collapse" href="#collapse-4514693aa4a351141269d9ac95460bcf"
        aria-expanded="true"
      >
        知识汇总
        <span class="list-group-count">(7)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse show" id="collapse-4514693aa4a351141269d9ac95460bcf"
           role="tabpanel" aria-labelledby="heading-4514693aa4a351141269d9ac95460bcf">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/android-kuo-zhan-zhi-shi-dian/" title="Android扩展知识点"
           class="list-group-item list-group-item-action
           active">
          <span class="category-post">Android扩展知识点</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/android-zhi-shi-dian-hui-zong/" title="Android知识点汇总"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Android知识点汇总</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/chang-jian-mian-shi-suan-fa-ti-hui-zong/" title="常见面试算法题汇总"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">常见面试算法题汇总</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/she-ji-mo-shi-hui-zong/" title="设计模式汇总"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">设计模式汇总</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/ji-suan-ji-wang-luo-ji-chu/" title="计算机网络基础"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">计算机网络基础</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/xing-neng-you-hua-zhi-shi-dian-hui-zong/" title="性能优化知识点汇总"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">性能优化知识点汇总</span>
        </a>
      
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/android-kai-yuan-ku-yuan-ma-fen-xi/" title="Android开源库源码分析"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">Android开源库源码分析</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
    
    
    
    <div class="category-sub row nomargin-x">
      <a class="category-subitem collapsed
          list-group-item category-item-action col-10 col-md-11 col-xm-11" title="知识笔记"
        id="heading-fc9ad1f315fb8be2c77447125c171f0f" role="tab" data-toggle="collapse" href="#collapse-fc9ad1f315fb8be2c77447125c171f0f"
        aria-expanded="false"
      >
        知识笔记
        <span class="list-group-count">(1)</span>
        <i class="iconfont icon-arrowright"></i>
      </a>
      
      <div class="category-collapse collapse " id="collapse-fc9ad1f315fb8be2c77447125c171f0f"
           role="tabpanel" aria-labelledby="heading-fc9ad1f315fb8be2c77447125c171f0f">
        
        
          
  <div class="category-post-list">
    
    
      
      
        <a href="/2023/08/24/docs/android/zhi-shi-bi-ji/yi-xie-livedata-nian-xing-shi-jian-jie-jue-fang-an/" title="一些LiveData粘性事件解决方案"
           class="list-group-item list-group-item-action
           ">
          <span class="category-post">一些LiveData粘性事件解决方案</span>
        </a>
      
    
  </div>

        
      </div>
    </div>
  
        
      </div>
    </div>
  
</div>


  </aside>


    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">Android扩展知识点</h1>
            
            
              <div class="markdown-body">
                
                <ul>
<li><a href="#art">ART</a><ul>
<li><a href="#art-%E5%8A%9F%E8%83%BD">ART 功能</a><ul>
<li><a href="#%E9%A2%84%E5%85%88-aot-%E7%BC%96%E8%AF%91">预先 (AOT) 编译</a></li>
<li><a href="#%E5%9E%83%E5%9C%BE%E5%9B%9E%E6%94%B6%E4%BC%98%E5%8C%96">垃圾回收优化</a></li>
<li><a href="#%E5%BC%80%E5%8F%91%E5%92%8C%E8%B0%83%E8%AF%95%E6%96%B9%E9%9D%A2%E7%9A%84%E4%BC%98%E5%8C%96">开发和调试方面的优化</a></li>
</ul>
</li>
<li><a href="#art-gc">ART GC</a></li>
</ul>
</li>
<li><a href="#hook">Hook</a><ul>
<li><a href="#%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B">基本流程</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B">使用示例</a></li>
</ul>
</li>
<li><a href="#proguard">Proguard</a><ul>
<li><a href="#%E8%A7%84%E5%88%99">规则</a></li>
<li><a href="#%E5%85%AC%E5%85%B1%E6%A8%A1%E6%9D%BF">公共模板</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84%E8%87%AA%E5%AE%9A%E4%B9%89%E6%B7%B7%E6%B7%86%E8%A7%84%E5%88%99">常用的自定义混淆规则</a></li>
<li><a href="#aar%E4%B8%AD%E5%A2%9E%E5%8A%A0%E7%8B%AC%E7%AB%8B%E7%9A%84%E6%B7%B7%E6%B7%86%E9%85%8D%E7%BD%AE">aar中增加独立的混淆配置</a></li>
<li><a href="#%E6%A3%80%E6%9F%A5%E6%B7%B7%E6%B7%86%E5%92%8C%E8%BF%BD%E8%B8%AA%E5%BC%82%E5%B8%B8">检查混淆和追踪异常</a></li>
</ul>
</li>
<li><a href="#%E6%9E%B6%E6%9E%84">架构</a><ul>
<li><a href="#mvc">MVC</a></li>
<li><a href="#mvp">MVP</a></li>
<li><a href="#mvvm">MVVM</a></li>
</ul>
</li>
<li><a href="#jetpack">Jetpack</a><ul>
<li><a href="#%E6%9E%B6%E6%9E%84-1">架构</a></li>
<li><a href="#%E4%BD%BF%E7%94%A8%E7%A4%BA%E4%BE%8B-1">使用示例</a></li>
</ul>
</li>
<li><a href="#ndk-%E5%BC%80%E5%8F%91">NDK 开发</a><ul>
<li><a href="#jni-%E5%9F%BA%E7%A1%80">JNI 基础</a><ul>
<li><a href="#%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B">数据类型</a></li>
<li><a href="#string-%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%87%BD%E6%95%B0%E6%93%8D%E4%BD%9C">String 字符串函数操作</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8-jni-%E8%AE%BF%E9%97%AE-java-%E5%AF%B9%E8%B1%A1%E6%96%B9%E6%B3%95">常用 JNI 访问 Java 对象方法</a></li>
</ul>
</li>
<li><a href="#ndk-%E5%BC%80%E5%8F%91-1">NDK 开发</a><ul>
<li><a href="#%E5%9F%BA%E7%A1%80%E5%BC%80%E5%8F%91%E6%B5%81%E7%A8%8B">基础开发流程</a></li>
<li><a href="#systemloadlibrary">System.loadLibrary()</a></li>
</ul>
</li>
<li><a href="#cmake-%E6%9E%84%E5%BB%BA-ndk-%E9%A1%B9%E7%9B%AE">CMake 构建 NDK 项目</a></li>
<li><a href="#%E5%B8%B8%E7%94%A8%E7%9A%84-android-ndk-%E5%8E%9F%E7%94%9F-api">常用的 Android NDK 原生 API</a></li>
</ul>
</li>
<li><a href="#%E7%B1%BB%E5%8A%A0%E8%BD%BD%E5%99%A8">类加载器</a><ul>
<li><a href="#%E5%8F%8C%E4%BA%B2%E5%A7%94%E6%89%98%E6%A8%A1%E5%BC%8F">双亲委托模式</a></li>
<li><a href="#dexpathlist">DexPathList</a></li>
</ul>
</li>
</ul>
<h1 id="ART"><a href="#ART" class="headerlink" title="ART"></a>ART</h1><p>ART 代表 Android Runtime，其处理应用程序执行的方式完全不同于 Dalvik，Dalvik 是依靠一个 Just-In-Time (JIT)<br>编译器去解释字节码。开发者编译后的应用代码需要通过一个解释器在用户的设备上运行，这一机制并不高效，但让应用能更容易在不同硬件和架构上运<br>行。ART 则完全改变了这套做法，在应用安装时就预编译字节码到机器语言，这一机制叫 Ahead-Of-Time (<br>AOT）编译。在移除解释代码这一过程后，应用程序执行将更有效率，启动更快。</p>
<h2 id="ART-功能"><a href="#ART-功能" class="headerlink" title="ART 功能"></a>ART 功能</h2><h3 id="预先-AOT-编译"><a href="#预先-AOT-编译" class="headerlink" title="预先 (AOT) 编译"></a>预先 (AOT) 编译</h3><p>ART 引入了预先编译机制，可提高应用的性能。ART 还具有比 Dalvik 更严格的安装时验证。在安装时，ART 使用设备自带的 dex2oat<br>工具来编译应用。该实用工具接受 DEX 文件作为输入，并为目标设备生成经过编译的应用可执行文件。该工具应能够顺利编译所有有效的<br>DEX 文件。</p>
<h3 id="垃圾回收优化"><a href="#垃圾回收优化" class="headerlink" title="垃圾回收优化"></a>垃圾回收优化</h3><p>垃圾回收 (GC) 可能有损于应用性能，从而导致显示不稳定、界面响应速度缓慢以及其他问题。ART 通过以下几种方式对垃圾回收做了优化：</p>
<ul>
<li>只有一次（而非两次）GC 暂停</li>
<li>在 GC 保持暂停状态期间并行处理</li>
<li>在清理最近分配的短时对象这种特殊情况中，回收器的总 GC 时间更短</li>
<li>优化了垃圾回收的工效，能够更加及时地进行并行垃圾回收，这使得 GC_FOR_ALLOC 事件在典型用例中极为罕见</li>
<li>压缩 GC 以减少后台内存使用和碎片</li>
</ul>
<h3 id="开发和调试方面的优化"><a href="#开发和调试方面的优化" class="headerlink" title="开发和调试方面的优化"></a>开发和调试方面的优化</h3><ul>
<li>支持采样分析器</li>
</ul>
<p>一直以来，开发者都使用 Traceview 工具（用于跟踪应用执行情况）作为分析器。虽然 Traceview 可提供有用的信息，但每次方法调用产生的开销会导致<br>Dalvik 分析结果出现偏差，而且使用该工具明显会影响运行时性能</p>
<p>ART 添加了对没有这些限制的专用采样分析器的支持，因而可更准确地了解应用执行情况，而不会明显减慢速度。KitKat 版本为 Dalvik 的<br>Traceview 添加了采样支持。</p>
<ul>
<li>支持更多调试功能</li>
</ul>
<p>ART 支持许多新的调试选项，特别是与监控和垃圾回收相关的功能。例如，查看堆栈跟踪中保留了哪些锁，然后跳转到持有锁的线程；询问指定类的当前活动的实例数、请求查看实例，以及查看使对象保持有效状态的参考；过滤特定实例的事件（如断点）等。</p>
<ul>
<li>优化了异常和崩溃报告中的诊断详细信息</li>
</ul>
<p>当发生运行时异常时，ART 会为您提供尽可能多的上下文和详细信息。ART<br>会提供 <code>java.lang.ClassCastException</code>、<code>java.lang.ClassNotFoundException</code> 和 <code>java.lang.NullPointerException</code><br>的更多异常详细信息（较高版本的 Dalvik 会提供 <code>java.lang.ArrayIndexOutOfBoundsException</code><br>和 <code>java.lang.ArrayStoreException</code> 的更多异常详细信息，这些信息现在包括数组大小和越界偏移量；ART 也提供这类信息）。</p>
<h2 id="ART-GC"><a href="#ART-GC" class="headerlink" title="ART GC"></a>ART GC</h2><p>ART 有多个不同的 GC 方案，这些方案包括运行不同垃圾回收器。默认方案是 CMS（并发标记清除）方案，主要使用粘性 CMS 和部分 CMS。粘性<br>CMS 是 ART 的不移动分代垃圾回收器。它仅扫描堆中自上次 GC 后修改的部分，并且只能回收自上次 GC 后分配的对象。除 CMS<br>方案外，当应用将进程状态更改为察觉不到卡顿的进程状态（例如，后台或缓存）时，ART 将执行堆压缩。</p>
<p>除了新的垃圾回收器之外，ART 还引入了一种基于位图的新内存分配程序，称为<br>RosAlloc（插槽运行分配器）。此新分配器具有分片锁，当分配规模较小时可添加线程的本地缓冲区，因而性能优于 DlMalloc。</p>
<p>与 Dalvik 相比，ART CMS 垃圾回收计划在很多方面都有一定的改善：</p>
<ul>
<li><p>与 Dalvik 相比，暂停次数从 2 次减少到 1 次。Dalvik 的第一次暂停主要是为了进行根标记，即在 ART 中进行并发标记，让线程标记自己的根，然后马上恢复运行。</p>
</li>
<li><p>与 Dalvik 类似，ART GC 在清除过程开始之前也会暂停 1 次。两者在这方面的主要差异在于：在此暂停期间，某些 Dalvik 环节在 ART<br>中并发进行。这些环节包括 java.lang.ref.Reference 处理、系统弱清除（例如，jni 弱全局等）、重新标记非线程根和卡片预清理。在 ART<br>暂停期间仍进行的阶段包括扫描脏卡片以及重新标记线程根，这些操作有助于缩短暂停时间。</p>
</li>
<li><p>相对于 Dalvik，ART GC 改进的最后一个方面是粘性 CMS 回收器增加了 GC 吞吐量。不同于普通的分代 GC，粘性 CMS<br>不移动。系统会将年轻对象保存在一个分配堆栈（基本上是 java.lang.Object<br>数组）中，而非为其设置一个专属区域。这样可以避免移动所需的对象以维持低暂停次数，但缺点是容易在堆栈中加入大量复杂对象图像而使堆栈变长。</p>
</li>
</ul>
<p>ART GC 与 Dalvik 的另一个主要区别在于 ART GC 引入了移动垃圾回收器。使用移动 GC 的目的在于通过堆压缩来减少后台应用使用的内存。目前，触发堆压缩的事件是<br>ActivityManager 进程状态的改变。当应用转到后台运行时，它会通知 ART 已进入不再“感知”卡顿的进程状态。此时 ART<br>会进行一些操作（例如，压缩和监视器压缩），从而导致应用线程长时间暂停。目前正在使用的两个移动 GC 是同构空间压缩和半空间压缩。</p>
<ul>
<li><p>半空间压缩将对象在两个紧密排列的碰撞指针空间之间进行移动。这种移动 GC<br>适用于小内存设备，因为它可以比同构空间压缩稍微多节省一点内存。额外节省出的空间主要来自紧密排列的对象，这样可以避免<br>RosAlloc/DlMalloc 分配器占用开销。由于 CMS 仍在前台使用，且不能从碰撞指针空间中进行收集，因此当应用在前台使用时，半空间还要再进行一次转换。这种情况并不理想，因为它可能引起较长时间的暂停。</p>
</li>
<li><p>同构空间压缩通过将对象从一个 RosAlloc 空间复制到另一个 RosAlloc<br>空间来实现。这有助于通过减少堆碎片来减少内存使用量。这是目前非低内存设备的默认压缩模式。相比半空间压缩，同构空间压缩的主要优势在于应用从后台切换到前台时无需进行堆转换。</p>
</li>
</ul>
<h1 id="Hook"><a href="#Hook" class="headerlink" title="Hook"></a>Hook</h1><h2 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h2><p>1、根据需求确定 要 hook 的对象<br>2、寻找要hook的对象的持有者，拿到要 hook 的对象<br>3、定义“要 hook 的对象”的代理类，并且创建该类的对象<br>4、使用上一步创建出来的对象，替换掉要 hook 的对象</p>
<h2 id="使用示例"><a href="#使用示例" class="headerlink" title="使用示例"></a>使用示例</h2><figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * hook的核心代码</span><br><span class="hljs-comment"> * 这个方法的唯一目的：用自己的点击事件，替换掉 View 原来的点击事件</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> view hook的范围仅限于这个view</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@SuppressLint({"DiscouragedPrivateApi", "PrivateApi"})</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">hook</span><span class="hljs-params">(Context context,<span class="hljs-keyword">final</span> View view)</span>{<span class="hljs-comment">//</span><br>        <span class="hljs-keyword">try</span>{<br>        <span class="hljs-comment">// 反射执行View类的getListenerInfo()方法，拿到v的mListenerInfo对象，这个对象就是点击事件的持有者</span><br>        Method method=View.class.getDeclaredMethod(<span class="hljs-string">"getListenerInfo"</span>);<br>        method.setAccessible(<span class="hljs-literal">true</span>);<span class="hljs-comment">//由于getListenerInfo()方法并不是public的，所以要加这个代码来保证访问权限</span><br>        Object mListenerInfo=method.invoke(view);<span class="hljs-comment">//这里拿到的就是mListenerInfo对象，也就是点击事件的持有者</span><br><br>        <span class="hljs-comment">// 要从这里面拿到当前的点击事件对象</span><br>        Class&lt;?&gt; listenerInfoClz=Class.forName(<span class="hljs-string">"android.view.View$ListenerInfo"</span>);<span class="hljs-comment">// 这是内部类的表示方法</span><br>        Field field=listenerInfoClz.getDeclaredField(<span class="hljs-string">"mOnClickListener"</span>);<br><span class="hljs-keyword">final</span> View.OnClickListener onClickListenerInstance=(View.OnClickListener)field.get(mListenerInfo);<span class="hljs-comment">//取得真实的mOnClickListener对象</span><br><br>        <span class="hljs-comment">// 2. 创建我们自己的点击事件代理类</span><br>        <span class="hljs-comment">//   方式1：自己创建代理类</span><br>        <span class="hljs-comment">//   ProxyOnClickListener proxyOnClickListener = new ProxyOnClickListener(onClickListenerInstance);</span><br>        <span class="hljs-comment">//   方式2：由于View.OnClickListener是一个接口，所以可以直接用动态代理模式</span><br>        <span class="hljs-comment">// Proxy.newProxyInstance的3个参数依次分别是：</span><br>        <span class="hljs-comment">// 本地的类加载器;</span><br>        <span class="hljs-comment">// 代理类的对象所继承的接口（用Class数组表示，支持多个接口）</span><br>        <span class="hljs-comment">// 代理类的实际逻辑，封装在new出来的InvocationHandler内</span><br>        Object proxyOnClickListener=Proxy.newProxyInstance(context.getClass().getClassLoader(),<span class="hljs-keyword">new</span> <span class="hljs-title class_">Class</span>[]{View.OnClickListener.class},<span class="hljs-keyword">new</span> <span class="hljs-title class_">InvocationHandler</span>(){<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Object <span class="hljs-title function_">invoke</span><span class="hljs-params">(Object proxy,Method method,Object[]args)</span><span class="hljs-keyword">throws</span> Throwable{<br>        Log.d(<span class="hljs-string">"HookSetOnClickListener"</span>,<span class="hljs-string">"点击事件被hook到了"</span>);<span class="hljs-comment">//加入自己的逻辑</span><br>        <span class="hljs-keyword">return</span> method.invoke(onClickListenerInstance,args);<span class="hljs-comment">//执行被代理的对象的逻辑</span><br>        }<br>        });<br>        <span class="hljs-comment">// 3. 用我们自己的点击事件代理类，设置到"持有者"中</span><br>        field.set(mListenerInfo,proxyOnClickListener);<br>        }<span class="hljs-keyword">catch</span>(Exception e){<br>        e.printStackTrace();<br>        }<br>        }<br><br><span class="hljs-comment">// 自定义代理类</span><br><span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ProxyOnClickListener</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">View</span>.OnClickListener {<br>    View.OnClickListener oriLis;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ProxyOnClickListener</span><span class="hljs-params">(View.OnClickListener oriLis)</span> {<br>        <span class="hljs-built_in">this</span>.oriLis = oriLis;<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onClick</span><span class="hljs-params">(View v)</span> {<br>        Log.d(<span class="hljs-string">"HookSetOnClickListener"</span>, <span class="hljs-string">"点击事件被hook到了"</span>);<br>        <span class="hljs-keyword">if</span> (oriLis != <span class="hljs-literal">null</span>) {<br>            oriLis.onClick(v);<br>        }<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<h1 id="Proguard"><a href="#Proguard" class="headerlink" title="Proguard"></a>Proguard</h1><p>Proguard 具有以下三个功能：</p>
<ul>
<li>压缩（Shrink）: 检测和删除没有使用的类，字段，方法和特性</li>
<li>优化（Optimize） : 分析和优化Java字节码</li>
<li>混淆（Obfuscate）: 使用简短的无意义的名称，对类，字段和方法进行重命名</li>
</ul>
<h2 id="规则"><a href="#规则" class="headerlink" title="规则"></a>规则</h2><ul>
<li>关键字</li>
</ul>
<table>
<thead>
<tr>
<th>关键字</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>keep</td>
<td>保留类和类中的成员，防止被混淆或移除</td>
</tr>
<tr>
<td>keepnames</td>
<td>保留类和类中的成员，防止被混淆，成员没有被引用会被移除</td>
</tr>
<tr>
<td>keepclassmembers</td>
<td>只保留类中的成员，防止被混淆或移除</td>
</tr>
<tr>
<td>keepclassmembernames</td>
<td>只保留类中的成员，防止被混淆，成员没有引用会被移除</td>
</tr>
<tr>
<td>keepclasseswithmembers</td>
<td>保留类和类中的成员，防止被混淆或移除，保留指明的成员</td>
</tr>
<tr>
<td>keepclasseswithmembernames</td>
<td>保留类和类中的成员，防止被混淆，保留指明的成员，成员没有引用会被移除</td>
</tr>
</tbody></table>
<ul>
<li>通配符</li>
</ul>
<table>
<thead>
<tr>
<th>通配符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>&lt;field&gt;</td>
<td>匹配类中的所有字段</td>
</tr>
<tr>
<td>&lt;method&gt;</td>
<td>匹配类中所有的方法</td>
</tr>
<tr>
<td>&lt;init&gt;</td>
<td>匹配类中所有的构造函数</td>
</tr>
<tr>
<td>*</td>
<td>匹配任意长度字符，不包含包名分隔符(.)</td>
</tr>
<tr>
<td>**</td>
<td>匹配任意长度字符，包含包名分隔符(.)</td>
</tr>
<tr>
<td>***</td>
<td>匹配任意参数类型</td>
</tr>
</tbody></table>
<ul>
<li>指定混淆时可使用字典</li>
</ul>
<figure class="highlight diff"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs diff"><span class="hljs-deletion">-applymapping filename 指定重用一个已经写好了的map文件作为新旧元素名的映射。</span><br><span class="hljs-deletion">-obfuscationdictionary filename 指定一个文本文件用来生成混淆后的名字。</span><br><span class="hljs-deletion">-classobfuscationdictionary filename 指定一个混淆类名的字典</span><br><span class="hljs-deletion">-packageobfuscationdictionary filename 指定一个混淆包名的字典</span><br><span class="hljs-deletion">-overloadaggressively 混淆的时候大量使用重载，多个方法名使用同一个混淆名（慎用）</span><br></code></pre></td></tr></tbody></table></figure>

<h2 id="公共模板"><a href="#公共模板" class="headerlink" title="公共模板"></a>公共模板</h2><figure class="highlight clean"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br></pre></td><td class="code"><pre><code class="hljs clean">#############################################<br>#<br># 对于一些基本指令的添加<br>#<br>#############################################<br># 代码混淆压缩比，在 <span class="hljs-number">0</span>~<span class="hljs-number">7</span> 之间，默认为 <span class="hljs-number">5</span>，一般不做修改<br>-optimizationpasses <span class="hljs-number">5</span><br><br># 混合时不使用大小写混合，混合后的类名为小写<br>-dontusemixedcaseclassnames<br><br># 指定不去忽略非公共库的类<br>-dontskipnonpubliclibraryclasses<br><br># 这句话能够使我们的项目混淆后产生映射文件<br># 包含有类名-&gt;混淆后类名的映射关系<br>-verbose<br><br># 指定不去忽略非公共库的类成员<br>-dontskipnonpubliclibraryclassmembers<br><br># 不做预校验，preverify 是 proguard 的四个步骤之一，Android 不需要 preverify，去掉这一步能够加快混淆速度。<br>-dontpreverify<br><br># 保留 Annotation 不混淆<br>-keepattributes *Annotation*,InnerClasses<br><br># 避免混淆泛型<br>-keepattributes Signature<br><br># 抛出异常时保留代码行号<br>-keepattributes SourceFile,LineNumberTable<br><br># 指定混淆是采用的算法，后面的参数是一个过滤器<br># 这个过滤器是谷歌推荐的算法，一般不做更改<br>-optimizations !<span class="hljs-keyword">code</span>/simplification/cast,!field<span class="hljs-comment">/*,!class/merging/*</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment">#############################################</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment"># Android开发中一些需要保留的公共部分</span><br><span class="hljs-comment">#</span><br><span class="hljs-comment">#############################################</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留我们使用的四大组件，自定义的 Application 等等这些类不被混淆</span><br><span class="hljs-comment"># 因为这些子类都有可能被外部调用</span><br><span class="hljs-comment">-keep public class * extends android.app.Activity</span><br><span class="hljs-comment">-keep public class * extends android.app.Appliction</span><br><span class="hljs-comment">-keep public class * extends android.app.Service</span><br><span class="hljs-comment">-keep public class * extends android.content.BroadcastReceiver</span><br><span class="hljs-comment">-keep public class * extends android.content.ContentProvider</span><br><span class="hljs-comment">-keep public class * extends android.app.backup.BackupAgentHelper</span><br><span class="hljs-comment">-keep public class * extends android.preference.Preference</span><br><span class="hljs-comment">-keep public class * extends android.view.View</span><br><span class="hljs-comment">-keep public class com.android.vending.licensing.ILicensingService</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留 support 下的所有类及其内部类</span><br><span class="hljs-comment">-keep class android.support.** { *; }</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留继承的</span><br><span class="hljs-comment">-keep public class * extends android.support.v4.**</span><br><span class="hljs-comment">-keep public class * extends android.support.v7.**</span><br><span class="hljs-comment">-keep public class * extends android.support.annotation.**</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留 R 下面的资源</span><br><span class="hljs-comment">-keep class **.R$* { *; }</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留本地 native 方法不被混淆</span><br><span class="hljs-comment">-keepclasseswithmembernames class * {</span><br><span class="hljs-comment">    native &lt;methods&gt;;</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留在 Activity 中的方法参数是view的方法，</span><br><span class="hljs-comment"># 这样以来我们在 layout 中写的 onClick 就不会被影响</span><br><span class="hljs-comment">-keepclassmembers class * extends android.app.Activity {</span><br><span class="hljs-comment">    public void *(android.view.View);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留枚举类不被混淆</span><br><span class="hljs-comment">-keepclassmembers enum * {</span><br><span class="hljs-comment">    public static **[] values();</span><br><span class="hljs-comment">    public static ** valueOf(java.lang.String);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留我们自定义控件（继承自 View）不被混淆</span><br><span class="hljs-comment">-keep public class * extends android.view.View {</span><br><span class="hljs-comment">    *** get*();</span><br><span class="hljs-comment">    void set*(***);</span><br><span class="hljs-comment">    public &lt;init&gt;(android.content.Context);</span><br><span class="hljs-comment">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet);</span><br><span class="hljs-comment">    public &lt;init&gt;(android.content.Context, android.util.AttributeSet, int);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留 Parcelable 序列化类不被混淆</span><br><span class="hljs-comment">-keep class * implements android.os.Parcelable {</span><br><span class="hljs-comment">    public static final android.os.Parcelable$Creator *;</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 保留 Serializable 序列化的类不被混淆</span><br><span class="hljs-comment">-keepnames class * implements java.io.Serializable</span><br><span class="hljs-comment">-keepclassmembers class * implements java.io.Serializable {</span><br><span class="hljs-comment">    static final long serialVersionUID;</span><br><span class="hljs-comment">    private static final java.io.ObjectStreamField[] serialPersistentFields;</span><br><span class="hljs-comment">    !static !transient &lt;fields&gt;;</span><br><span class="hljs-comment">    !private &lt;fields&gt;;</span><br><span class="hljs-comment">    !private &lt;methods&gt;;</span><br><span class="hljs-comment">    private void writeObject(java.io.ObjectOutputStream);</span><br><span class="hljs-comment">    private void readObject(java.io.ObjectInputStream);</span><br><span class="hljs-comment">    java.lang.Object writeReplace();</span><br><span class="hljs-comment">    java.lang.Object readResolve();</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># 对于带有回调函数的 onXXEvent、**On*Listener 的，不能被混淆</span><br><span class="hljs-comment">-keepclassmembers class * {</span><br><span class="hljs-comment">    void *(**On*Event);</span><br><span class="hljs-comment">    void *(**On*Listener);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># webView 处理，项目中没有使用到 webView 忽略即可</span><br><span class="hljs-comment">-keepclassmembers class fqcn.of.javascript.interface.for.webview {</span><br><span class="hljs-comment">    public *;</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment">-keepclassmembers class * extends android.webkit.webViewClient {</span><br><span class="hljs-comment">    public void *(android.webkit.WebView, java.lang.String, android.graphics.Bitmap);</span><br><span class="hljs-comment">    public boolean *(android.webkit.WebView, java.lang.String);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment">-keepclassmembers class * extends android.webkit.webViewClient {</span><br><span class="hljs-comment">    public void *(android.webkit.webView, java.lang.String);</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># js</span><br><span class="hljs-comment">-keepattributes JavascriptInterface</span><br><span class="hljs-comment">-keep class android.webkit.JavascriptInterface { *; }</span><br><span class="hljs-comment">-keepclassmembers class * {</span><br><span class="hljs-comment">    @android.webkit.JavascriptInterface &lt;methods&gt;;</span><br><span class="hljs-comment">}</span><br><span class="hljs-comment"></span><br><span class="hljs-comment"># @Keep</span><br><span class="hljs-comment">-keep,allowobfuscation @interface android.support.annotation.Keep</span><br><span class="hljs-comment">-keep @android.support.annotation.Keep class *</span><br><span class="hljs-comment">-keepclassmembers class * {</span><br><span class="hljs-comment">    @android.support.annotation.Keep *;</span><br><span class="hljs-comment">}</span><br></code></pre></td></tr></tbody></table></figure>

<h2 id="常用的自定义混淆规则"><a href="#常用的自定义混淆规则" class="headerlink" title="常用的自定义混淆规则"></a>常用的自定义混淆规则</h2><figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs xml"># 通配符*，匹配任意长度字符，但不含包名分隔符(.)<br>        # 通配符**，匹配任意长度字符，并且包含包名分隔符(.)<br><br>        # 不混淆某个类<br>        -keep public class com.jasonwu.demo.Test { *; }<br><br>        # 不混淆某个包所有的类<br>        -keep class com.jasonwu.demo.test.** { *; }<br><br>        # 不混淆某个类的子类<br>        -keep public class * com.jasonwu.demo.Test { *; }<br><br>        # 不混淆所有类名中包含了 ``model`` 的类及其成员<br>        -keep public class **.*model*.** {*;}<br><br>        # 不混淆某个接口的实现<br>        -keep class * implements com.jasonwu.demo.TestInterface { *; }<br><br>        # 不混淆某个类的构造方法<br>        -keepclassmembers class com.jasonwu.demo.Test {<br>        public<br><span class="hljs-tag">&lt;<span class="hljs-name">init</span>&gt;</span>();<br>    }<br><br>    # 不混淆某个类的特定的方法<br>    -keepclassmembers class com.jasonwu.demo.Test {<br>    public void test(java.lang.String);<br>    }<br></code></pre></td></tr></tbody></table></figure>

<h2 id="aar中增加独立的混淆配置"><a href="#aar中增加独立的混淆配置" class="headerlink" title="aar中增加独立的混淆配置"></a>aar中增加独立的混淆配置</h2><p><code>build.gralde</code></p>
<figure class="highlight gradle"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs gradle">android {<br>    ···<br>    defaultConfig {<br>        ···<br>        consumerProguardFile <span class="hljs-string">'proguard-rules.pro'</span><br>    }<br>    ···<br>}<br></code></pre></td></tr></tbody></table></figure>

<h2 id="检查混淆和追踪异常"><a href="#检查混淆和追踪异常" class="headerlink" title="检查混淆和追踪异常"></a>检查混淆和追踪异常</h2><p>开启 Proguard 功能，则每次构建时 ProGuard 都会输出下列文件：</p>
<ul>
<li><p>dump.txt<br>说明 APK 中所有类文件的内部结构。</p>
</li>
<li><p>mapping.txt<br>提供原始与混淆过的类、方法和字段名称之间的转换。</p>
</li>
<li><p>seeds.txt<br>列出未进行混淆的类和成员。</p>
</li>
<li><p>usage.txt<br>列出从 APK 移除的代码。</p>
</li>
</ul>
<p>这些文件保存在 /build/outputs/mapping/release/ 中。我们可以查看 seeds.txt 里面是否是我们需要保留的，以及 usage.txt<br>里查看是否有误删除的代码。 mapping.txt 文件很重要，由于我们的部分代码是经过重命名的，如果该部分出现<br>bug，对应的异常堆栈信息里的类或成员也是经过重命名的，难以定位问题。我们可以用 retrace 脚本（在 Windows 上为 retrace.bat；在<br>Mac/Linux 上为 retrace.sh）。它位于 /tools/proguard/ 目录中。该脚本利用 mapping.txt<br>文件和你的异常堆栈文件生成没有经过混淆的异常堆栈文件,这样就可以看清是哪里出问题了。使用 retrace 工具的语法如下：</p>
<figure class="highlight shell"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs shell">retrace.bat|retrace.sh [-verbose] mapping.txt [&lt;stacktrace_file&gt;]<br></code></pre></td></tr></tbody></table></figure>

<h1 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h1><h2 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCwLhGyLdicyLzgUDKFTZVt1OgU6iaSx2IUwnygzmQzW7Renaa8hmQ62cQ/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" srcset="/img/loading.gif" lazyload></p>
<p>在 Android 中，三者的关系如下：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCicNvEVMO9vDgukUR29Z1DCacZJwmmH1EEb7gUOZmDxolWexP01O8jfg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" srcset="/img/loading.gif" lazyload></p>
<p>由于在 Android 中 xml 布局的功能性太弱，所以 Activity 承担了绝大部分的工作，所以在 Android 中 mvc 更像：</p>
<p><img src="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCOq89MLQX4UM3dgBTQfU72desHb1XbOWRQZINnXOCCdZCuicUiaTHhtEg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" srcset="/img/loading.gif" lazyload></p>
<p>总结：</p>
<ul>
<li>具有一定的分层，model 解耦，controller 和 view 并没有解耦</li>
<li>controller 和 view 在 Android 中无法做到彻底分离，Controller 变得臃肿不堪</li>
<li>易于理解、开发速度快、可维护性高</li>
</ul>
<h2 id="MVP"><a href="#MVP" class="headerlink" title="MVP"></a>MVP</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCLVgibsuVQFguBI8FBdZibLNfpvbpd6njkdGWdyR2UL6TzMOhKHFqLC0Q/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" srcset="/img/loading.gif" lazyload></p>
<p>通过引入接口 BaseView，让相应的视图组件如 Activity，Fragment去实现 BaseView，把业务逻辑放在 presenter 层中，弱化 Model 只有跟<br>view 相关的操作都由 View 层去完成。</p>
<p>总结：</p>
<ul>
<li>彻底解决了 MVC 中 View 和 Controller 傻傻分不清楚的问题</li>
<li>但是随着业务逻辑的增加，一个页面可能会非常复杂，UI 的改变是非常多，会有非常多的 case，这样就会造成 View 的接口会很庞大</li>
<li>更容易单元测试</li>
</ul>
<h2 id="MVVM"><a href="#MVVM" class="headerlink" title="MVVM"></a>MVVM</h2><p><img src="https://mmbiz.qpic.cn/mmbiz_png/zKFJDM5V3Wy5xbLTp6JMMdouZiavFxyYCMygIDD6xo5djkq6Y3jZo53sT2A4kKNaz8JEVRwmUnTmcAwJm0pZVWg/640?wx_fmt=png&amp;tp=webp&amp;wxfrom=5&amp;wx_lazy=1&amp;wx_co=1" srcset="/img/loading.gif" lazyload></p>
<p>在 MVP 中 View 和 Presenter 要相互持有，方便调用对方，而在 MVP 中 View 和 ViewModel 通过 Binding 进行关联，他们之前的关联处理通过<br>DataBinding 完成。</p>
<p>总结：</p>
<ul>
<li>很好的解决了 MVC 和 MVP 的问题</li>
<li>视图状态较多，ViewModel 的构建和维护的成本都会比较高</li>
<li>但是由于数据和视图的双向绑定，导致出现问题时不太好定位来源</li>
</ul>
<h1 id="Jetpack"><a href="#Jetpack" class="headerlink" title="Jetpack"></a>Jetpack</h1><h2 id="架构-1"><a href="#架构-1" class="headerlink" title="架构"></a>架构</h2><p><img src="https://developer.android.google.cn/topic/libraries/architecture/images/final-architecture.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="使用示例-1"><a href="#使用示例-1" class="headerlink" title="使用示例"></a>使用示例</h2><p><code>build.gradle</code></p>
<figure class="highlight groovy"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs groovy">android {<br>    · · ·<br>    dataBinding {<br>        enabled = <span class="hljs-literal">true</span><br>    }<br>}<br>dependencies {<br>    · · ·<br>    implementation <span class="hljs-string">"androidx.fragment:fragment-ktx:$rootProject.fragmentVersion"</span><br>    implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-extensions:$rootProject.lifecycleVersion"</span><br>    implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-livedata-ktx:$rootProject.lifecycleVersion"</span><br>    implementation <span class="hljs-string">"androidx.lifecycle:lifecycle-viewmodel-ktx:$rootProject.lifecycleVersion"</span><br>}<br></code></pre></td></tr></tbody></table></figure>

<p><code>fragment_plant_detail.xml</code></p>
<figure class="highlight xml"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs xml"><br><span class="hljs-tag">&lt;<span class="hljs-name">layout</span> <span class="hljs-attr">xmlns:android</span>=<span class="hljs-string">"http://schemas.android.com/apk/res/android"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:app</span>=<span class="hljs-string">"http://schemas.android.com/apk/res-auto"</span></span><br><span class="hljs-tag">        <span class="hljs-attr">xmlns:tools</span>=<span class="hljs-string">"http://schemas.android.com/tools"</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">data</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">variable</span></span><br><span class="hljs-tag">                <span class="hljs-attr">name</span>=<span class="hljs-string">"viewModel"</span></span><br><span class="hljs-tag">                <span class="hljs-attr">type</span>=<span class="hljs-string">"com.google.samples.apps.sunflower.viewmodels.PlantDetailViewModel"</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">data</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_width</span>=<span class="hljs-string">"match_parent"</span></span><br><span class="hljs-tag">            <span class="hljs-attr">android:layout_height</span>=<span class="hljs-string">"match_parent"</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">TextView</span></span><br><span class="hljs-tag">        ···</span><br><span class="hljs-tag">        <span class="hljs-attr">android:text</span>=<span class="hljs-string">"@{viewModel.plant.name}"</span>/&gt;</span><br><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">androidx.constraintlayout.widget.ConstraintLayout</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">layout</span>&gt;</span><br></code></pre></td></tr></tbody></table></figure>

<p><code>PlantDetailFragment.kt</code></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlantDetailFragment</span> : <span class="hljs-type">Fragment</span>() {<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> args: PlantDetailFragmentArgs <span class="hljs-keyword">by</span> navArgs()<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">lateinit</span> <span class="hljs-keyword">var</span> shareText: String<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> plantDetailViewModel: PlantDetailViewModel <span class="hljs-keyword">by</span> viewModels {<br>        InjectorUtils.providePlantDetailViewModelFactory(requireActivity(), args.plantId)<br>    }<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCreateView</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        inflater: <span class="hljs-type">LayoutInflater</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        container: <span class="hljs-type">ViewGroup</span>?,</span></span><br><span class="hljs-params"><span class="hljs-function">        savedInstanceState: <span class="hljs-type">Bundle</span>?</span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: View? {<br>        <span class="hljs-keyword">val</span> binding = DataBindingUtil.inflate&lt;FragmentPlantDetailBinding&gt;(<br>            inflater, R.layout.fragment_plant_detail, container, <span class="hljs-literal">false</span><br>        ).apply {<br>            viewModel = plantDetailViewModel<br>            lifecycleOwner = <span class="hljs-keyword">this</span><span class="hljs-symbol">@PlantDetailFragment</span><br>        }<br><br>        plantDetailViewModel.plant.observe(<span class="hljs-keyword">this</span>) { plant -&gt;<br>            <span class="hljs-comment">// 更新相关 UI</span><br>        }<br><br>        <span class="hljs-keyword">return</span> binding.root<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><code>Plant.kt</code></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">data</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Plant</span>(<br>    <span class="hljs-keyword">val</span> name: String<br>)<br></code></pre></td></tr></tbody></table></figure>

<p><code>PlantDetailViewModel.kt</code></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlantDetailViewModel</span>(<br>    plantRepository: PlantRepository,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> plantId: String<br>) : ViewModel() {<br><br>    <span class="hljs-keyword">val</span> plant: LiveData&lt;Plant&gt;<br><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">onCleared</span><span class="hljs-params">()</span></span> {<br>        <span class="hljs-keyword">super</span>.onCleared()<br>        viewModelScope.cancel()<br>    }<br><br>    <span class="hljs-keyword">init</span> {<br>        plant = plantRepository.getPlant(plantId)<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><code>PlantDetailViewModelFactory.kt</code></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PlantDetailViewModelFactory</span>(<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> plantRepository: PlantRepository,<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">val</span> plantId: String<br>) : ViewModelProvider.NewInstanceFactory() {<br><br>    <span class="hljs-meta">@Suppress(<span class="hljs-string">"UNCHECKED_CAST"</span>)</span><br>    <span class="hljs-keyword">override</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-type">&lt;T : ViewModel&gt;</span> <span class="hljs-title">create</span><span class="hljs-params">(modelClass: <span class="hljs-type">Class</span>&lt;<span class="hljs-type">T</span>&gt;)</span></span>: T {<br>        <span class="hljs-keyword">return</span> PlantDetailViewModel(plantRepository, plantId) <span class="hljs-keyword">as</span> T<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><code>InjectorUtils.kt</code></p>
<figure class="highlight kotlin"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs kotlin"><span class="hljs-keyword">object</span> InjectorUtils {<br>    <span class="hljs-keyword">private</span> <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">getPlantRepository</span><span class="hljs-params">(context: <span class="hljs-type">Context</span>)</span></span>: PlantRepository {<br>        ···<br>    }<br><br>    <span class="hljs-function"><span class="hljs-keyword">fun</span> <span class="hljs-title">providePlantDetailViewModelFactory</span><span class="hljs-params">(</span></span><br><span class="hljs-params"><span class="hljs-function">        context: <span class="hljs-type">Context</span>,</span></span><br><span class="hljs-params"><span class="hljs-function">        plantId: <span class="hljs-type">String</span></span></span><br><span class="hljs-params"><span class="hljs-function">    )</span></span>: PlantDetailViewModelFactory {<br>        <span class="hljs-keyword">return</span> PlantDetailViewModelFactory(getPlantRepository(context), plantId)<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<h1 id="NDK-开发"><a href="#NDK-开发" class="headerlink" title="NDK 开发"></a>NDK 开发</h1><blockquote>
<p>NDK 全称是 Native Development Kit，是一组可以让你在 Android 应用中编写实现 C/C++ 的工具，可以在项目用自己写源代码构建，也可以利用现有的预构建库。</p>
</blockquote>
<p>使用 NDK 的使用目的有：</p>
<ul>
<li>从设备获取更好的性能以用于计算密集型应用，例如游戏或物理模拟</li>
<li>重复使用自己或其他开发者的 C/C++ 库，便利于跨平台。</li>
<li>NDK 集成了譬如 OpenSL、Vulkan 等 API 规范的特定实现，以实现在 java 层无法做到的功能如提升音频性能等</li>
<li>增加反编译难度</li>
</ul>
<h2 id="JNI-基础"><a href="#JNI-基础" class="headerlink" title="JNI 基础"></a>JNI 基础</h2><h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ul>
<li>基本数据类型</li>
</ul>
<table>
<thead>
<tr>
<th>Java 类型</th>
<th>Native 类型</th>
<th>符号属性</th>
<th>字长</th>
</tr>
</thead>
<tbody><tr>
<td>boolean</td>
<td>jboolean</td>
<td>无符号</td>
<td>8位</td>
</tr>
<tr>
<td>byte</td>
<td>jbyte</td>
<td>无符号</td>
<td>8位</td>
</tr>
<tr>
<td>char</td>
<td>jchar</td>
<td>无符号</td>
<td>16位</td>
</tr>
<tr>
<td>short</td>
<td>jshort</td>
<td>有符号</td>
<td>16位</td>
</tr>
<tr>
<td>int</td>
<td>jnit</td>
<td>有符号</td>
<td>32位</td>
</tr>
<tr>
<td>long</td>
<td>jlong</td>
<td>有符号</td>
<td>64位</td>
</tr>
<tr>
<td>float</td>
<td>jfloat</td>
<td>有符号</td>
<td>32位</td>
</tr>
<tr>
<td>double</td>
<td>jdouble</td>
<td>有符号</td>
<td>64位</td>
</tr>
</tbody></table>
<ul>
<li>引用数据类型</li>
</ul>
<table>
<thead>
<tr>
<th>Java 引用类型</th>
<th>Native 类型</th>
<th>Java 引用类型</th>
<th>Native 类型</th>
</tr>
</thead>
<tbody><tr>
<td>All objects</td>
<td>jobject</td>
<td>char[]</td>
<td>jcharArray</td>
</tr>
<tr>
<td>java.lang.Class</td>
<td>jclass</td>
<td>short[]</td>
<td>jshortArray</td>
</tr>
<tr>
<td>java.lang.String</td>
<td>jstring</td>
<td>int[]</td>
<td>jintArray</td>
</tr>
<tr>
<td>Object[]</td>
<td>jobjectArray</td>
<td>long[]</td>
<td>jlongArray</td>
</tr>
<tr>
<td>boolean[]</td>
<td>jbooleanArray</td>
<td>float[]</td>
<td>jfloatArray</td>
</tr>
<tr>
<td>byte[]</td>
<td>jbyteArray</td>
<td>double[]</td>
<td>jdoubleArray</td>
</tr>
<tr>
<td>java.lang.Throwable</td>
<td>jthrowable</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="String-字符串函数操作"><a href="#String-字符串函数操作" class="headerlink" title="String 字符串函数操作"></a>String 字符串函数操作</h3><table>
<thead>
<tr>
<th>JNI 函数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>GetStringChars / ReleaseStringChars</td>
<td>获得或释放一个指向 Unicode 编码的字符串的指针（指 C/C++ 字符串）</td>
</tr>
<tr>
<td>GetStringUTFChars / ReleaseStringUTFChars</td>
<td>获得或释放一个指向 UTF-8 编码的字符串的指针（指 C/C++ 字符串）</td>
</tr>
<tr>
<td>GetStringLength</td>
<td>返回 Unicode 编码的字符串的长度</td>
</tr>
<tr>
<td>getStringUTFLength</td>
<td>返回 UTF-8 编码的字符串的长度</td>
</tr>
<tr>
<td>NewString</td>
<td>将 Unicode 编码的 C/C++ 字符串转换为 Java 字符串</td>
</tr>
<tr>
<td>NewStringUTF</td>
<td>将 UTF-8 编码的 C/C++ 字符串转换为 Java 字符串</td>
</tr>
<tr>
<td>GetStringCritical / ReleaseStringCritical</td>
<td>获得或释放一个指向字符串内容的指针(指 Java 字符串)</td>
</tr>
<tr>
<td>GetStringRegion</td>
<td>获取或者设置 Unicode 编码的字符串的指定范围的内容</td>
</tr>
<tr>
<td>GetStringUTFRegion</td>
<td>获取或者设置 UTF-8 编码的字符串的指定范围的内容</td>
</tr>
</tbody></table>
<h3 id="常用-JNI-访问-Java-对象方法"><a href="#常用-JNI-访问-Java-对象方法" class="headerlink" title="常用 JNI 访问 Java 对象方法"></a>常用 JNI 访问 Java 对象方法</h3><p><code>MyJob.java</code></p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.example.myjniproject;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MyJob</span> {<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">JOB_STRING</span> <span class="hljs-operator">=</span> <span class="hljs-string">"my_job"</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> jobId;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MyJob</span><span class="hljs-params">(<span class="hljs-type">int</span> jobId)</span> {<br>        <span class="hljs-built_in">this</span>.jobId = jobId;<br>    }<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getJobId</span><span class="hljs-params">()</span> {<br>        <span class="hljs-keyword">return</span> jobId;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<p><code>native-lib.cpp</code></p>
<figure class="highlight c++"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;jni.h&gt;</span></span><br><br><span class="hljs-keyword">extern</span> <span class="hljs-string">"C"</span><br><span class="hljs-function">JNIEXPORT jint JNICALL</span><br><span class="hljs-function"><span class="hljs-title">Java_com_example_myjniproject_MainActivity_getJobId</span><span class="hljs-params">(JNIEnv *env, jobject thiz, jobject job)</span> </span>{<br><br>    <span class="hljs-comment">// 根据实力获取 class 对象</span><br>    jclass jobClz = env-&gt;<span class="hljs-built_in">GetObjectClass</span>(job);<br>    <span class="hljs-comment">// 根据类名获取 class 对象</span><br>    jclass jobClz = env-&gt;<span class="hljs-built_in">FindClass</span>(<span class="hljs-string">"com/example/myjniproject/MyJob"</span>);<br><br>    <span class="hljs-comment">// 获取属性 id</span><br>    jfieldID fieldId = env-&gt;<span class="hljs-built_in">GetFieldID</span>(jobClz, <span class="hljs-string">"jobId"</span>, <span class="hljs-string">"I"</span>);<br>    <span class="hljs-comment">// 获取静态属性 id</span><br>    jfieldID sFieldId = env-&gt;<span class="hljs-built_in">GetStaticFieldID</span>(jobClz, <span class="hljs-string">"JOB_STRING"</span>, <span class="hljs-string">"Ljava/lang/String;"</span>);<br><br>    <span class="hljs-comment">// 获取方法 id</span><br>    jmethodID methodId = env-&gt;<span class="hljs-built_in">GetMethodID</span>(jobClz, <span class="hljs-string">"getJobId"</span>, <span class="hljs-string">"()I"</span>);<br>    <span class="hljs-comment">// 获取构造方法 id</span><br>    jmethodID  initMethodId = env-&gt;<span class="hljs-built_in">GetMethodID</span>(jobClz, <span class="hljs-string">"&lt;init&gt;"</span>, <span class="hljs-string">"(I)V"</span>);<br><br>    <span class="hljs-comment">// 根据对象属性 id 获取该属性值</span><br>    jint id = env-&gt;<span class="hljs-built_in">GetIntField</span>(job, fieldId);<br>    <span class="hljs-comment">// 根据对象方法 id 调用该方法</span><br>    jint id = env-&gt;<span class="hljs-built_in">CallIntMethod</span>(job, methodId);<br><br>    <span class="hljs-comment">// 创建新的对象</span><br>    jobject newJob = env-&gt;<span class="hljs-built_in">NewObject</span>(jobClz, initMethodId, <span class="hljs-number">10</span>);<br><br>    <span class="hljs-keyword">return</span> id;<br>}<br></code></pre></td></tr></tbody></table></figure>

<h2 id="NDK-开发-1"><a href="#NDK-开发-1" class="headerlink" title="NDK 开发"></a>NDK 开发</h2><h3 id="基础开发流程"><a href="#基础开发流程" class="headerlink" title="基础开发流程"></a>基础开发流程</h3><ul>
<li>在 java 中声明 native 方法</li>
</ul>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MainActivity</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">AppCompatActivity</span> {<br><br>    <span class="hljs-comment">// Used to load the 'native-lib' library on application startup.</span><br>    <span class="hljs-keyword">static</span> {<br>        System.loadLibrary(<span class="hljs-string">"native-lib"</span>);<br>    }<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">onCreate</span><span class="hljs-params">(Bundle savedInstanceState)</span> {<br>        <span class="hljs-built_in">super</span>.onCreate(savedInstanceState);<br>        setContentView(R.layout.activity_main);<br><br>        Log.d(<span class="hljs-string">"MainActivity"</span>, stringFromJNI());<br>    }<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">stringFromJNI</span><span class="hljs-params">()</span>;<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>在 <code>app/src/main</code> 目录下新建 cpp 目录，新建相关 cpp 文件，实现相关方法（AS 可用快捷键快速生成）</li>
</ul>
<p><code>native-lib.cpp</code></p>
<figure class="highlight mipsasm"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs mipsasm"><span class="hljs-comment">#include &lt;jni.h&gt;</span><br><br><span class="hljs-keyword">extern </span><span class="hljs-string">"C"</span> <span class="hljs-keyword">JNIEXPORT </span><span class="hljs-keyword">jstring </span><span class="hljs-keyword">JNICALL</span><br><span class="hljs-keyword"></span><span class="hljs-keyword">Java_com_example_myjniproject_MainActivity_stringFromJNI(</span><br><span class="hljs-keyword"></span>        <span class="hljs-keyword">JNIEnv </span>*env,<br>        <span class="hljs-keyword">jobject </span><span class="hljs-comment">/* this */</span>) {<br><span class="hljs-symbol">    std:</span>:string hello = <span class="hljs-string">"Hello from C++"</span>;<br>    return env-&gt;NewStringUTF(hello.c_str());<br>}<br></code></pre></td></tr></tbody></table></figure>

<blockquote>
<ul>
<li>函数名的格式遵循遵循如下规则：Java_包名_类名_方法名。</li>
<li>extern “C” 指定采用 C 语言的命名风格来编译，否则由于 C 与 C++ 风格不同，导致链接时无法找到具体的函数</li>
<li>JNIEnv*：表示一个指向 JNI 环境的指针，可以通过他来访问 JNI 提供的接口方法</li>
<li>jobject：表示 java 对象中的 this</li>
<li>JNIEXPORT 和 JNICALL：JNI 所定义的宏，可以在 jni.h 头文件中查找到</li>
</ul>
</blockquote>
<ul>
<li>通过 CMake 或者 ndk-build 构建动态库</li>
</ul>
<h3 id="System-loadLibrary"><a href="#System-loadLibrary" class="headerlink" title="System.loadLibrary()"></a>System.loadLibrary()</h3><p><code>java/lang/System.java</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@CallerSensitive</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">load</span><span class="hljs-params">(String filename)</span>{<br>        Runtime.getRuntime().load0(Reflection.getCallerClass(),filename);<br>        }<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>调用 <code>Runtime</code> 相关 native 方法</li>
</ul>
<p><code>java/lang/Runtime.java</code>:</p>
<figure class="highlight java"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">native</span> String <span class="hljs-title function_">nativeLoad</span><span class="hljs-params">(String filename,ClassLoader loader,Class&lt;?&gt; caller)</span>;<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li>native 方法的实现如下：</li>
</ul>
<p><code>dalvik/vm/native/java_lang_Runtime.cpp</code>:</p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">static</span> <span class="hljs-type">void</span> <span class="hljs-title">Dalvik_java_lang_Runtime_nativeLoad</span><span class="hljs-params">(<span class="hljs-type">const</span> u4* args,</span></span><br><span class="hljs-params"><span class="hljs-function">    JValue* pResult)</span></span><br><span class="hljs-function"></span>{<br>    ···<br>    <span class="hljs-type">bool</span> success;<br><br>    <span class="hljs-built_in">assert</span>(fileNameObj != <span class="hljs-literal">NULL</span>);<br>    <span class="hljs-comment">// 将 Java 的 library path String 转换到 native 的 String</span><br>    fileName = <span class="hljs-built_in">dvmCreateCstrFromString</span>(fileNameObj);<br><br>    success = <span class="hljs-built_in">dvmLoadNativeCode</span>(fileName, classLoader, &amp;reason);<br>    <span class="hljs-keyword">if</span> (!success) {<br>        <span class="hljs-type">const</span> <span class="hljs-type">char</span>* msg = (reason != <span class="hljs-literal">NULL</span>) ? reason : <span class="hljs-string">"unknown failure"</span>;<br>        result = <span class="hljs-built_in">dvmCreateStringFromCstr</span>(msg);<br>        <span class="hljs-built_in">dvmReleaseTrackedAlloc</span>((Object*) result, <span class="hljs-literal">NULL</span>);<br>    }<br>    ···<br>}<br></code></pre></td></tr></tbody></table></figure>

<ul>
<li><code>dvmLoadNativeCode</code> 函数实现如下：</li>
</ul>
<p><code>dalvik/vm/Native.cpp</code></p>
<figure class="highlight cpp"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function"><span class="hljs-type">bool</span> <span class="hljs-title">dvmLoadNativeCode</span><span class="hljs-params">(<span class="hljs-type">const</span> <span class="hljs-type">char</span>* pathName, Object* classLoader,</span></span><br><span class="hljs-params"><span class="hljs-function">        <span class="hljs-type">char</span>** detail)</span></span><br><span class="hljs-function"></span>{<br>    SharedLib* pEntry;<br>    <span class="hljs-type">void</span>* handle;<br>    ···<br>    *detail = <span class="hljs-literal">NULL</span>;<br><br>    <span class="hljs-comment">// 如果已经加载过了，则直接返回 true</span><br>    pEntry = <span class="hljs-built_in">findSharedLibEntry</span>(pathName);<br>    <span class="hljs-keyword">if</span> (pEntry != <span class="hljs-literal">NULL</span>) {<br>        <span class="hljs-keyword">if</span> (pEntry-&gt;classLoader != classLoader) {<br>            ···<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        }<br>        ···<br>        <span class="hljs-keyword">if</span> (!<span class="hljs-built_in">checkOnLoadResult</span>(pEntry))<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    }<br><br>    Thread* self = <span class="hljs-built_in">dvmThreadSelf</span>();<br>    ThreadStatus oldStatus = <span class="hljs-built_in">dvmChangeStatus</span>(self, THREAD_VMWAIT);<br>    <span class="hljs-comment">// 把.so mmap 到进程空间，并把 func 等相关信息填充到 soinfo 中</span><br>    handle = <span class="hljs-built_in">dlopen</span>(pathName, RTLD_LAZY);<br>    <span class="hljs-built_in">dvmChangeStatus</span>(self, oldStatus);<br>    ···<br>    <span class="hljs-comment">// 创建一个新的 entry</span><br>    SharedLib* pNewEntry;<br>    pNewEntry = (SharedLib*) <span class="hljs-built_in">calloc</span>(<span class="hljs-number">1</span>, <span class="hljs-built_in">sizeof</span>(SharedLib));<br>    pNewEntry-&gt;pathName = <span class="hljs-built_in">strdup</span>(pathName);<br>    pNewEntry-&gt;handle = handle;<br>    pNewEntry-&gt;classLoader = classLoader;<br>    <span class="hljs-built_in">dvmInitMutex</span>(&amp;pNewEntry-&gt;onLoadLock);<br>    <span class="hljs-built_in">pthread_cond_init</span>(&amp;pNewEntry-&gt;onLoadCond, <span class="hljs-literal">NULL</span>);<br>    pNewEntry-&gt;onLoadThreadId = self-&gt;threadId;<br><br>    <span class="hljs-comment">// 尝试添加到列表中</span><br>    SharedLib* pActualEntry = <span class="hljs-built_in">addSharedLibEntry</span>(pNewEntry);<br><br>    <span class="hljs-keyword">if</span> (pNewEntry != pActualEntry) {<br>        ···<br>        <span class="hljs-built_in">freeSharedLibEntry</span>(pNewEntry);<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">checkOnLoadResult</span>(pActualEntry);<br>    } <span class="hljs-keyword">else</span> {<br>        ···<br>        <span class="hljs-type">bool</span> result = <span class="hljs-literal">true</span>;<br>        <span class="hljs-type">void</span>* vonLoad;<br>        <span class="hljs-type">int</span> version;<br>        <span class="hljs-comment">// 调用该 so 库的 JNI_OnLoad 方法</span><br>        vonLoad = <span class="hljs-built_in">dlsym</span>(handle, <span class="hljs-string">"JNI_OnLoad"</span>);<br>        <span class="hljs-keyword">if</span> (vonLoad == <span class="hljs-literal">NULL</span>) {<br>            ···<br>        } <span class="hljs-keyword">else</span> {<br>            <span class="hljs-comment">// 调用 JNI_Onload 方法，重写类加载器。</span><br>            OnLoadFunc func = (OnLoadFunc)vonLoad;<br>            Object* prevOverride = self-&gt;classLoaderOverride;<br><br>            self-&gt;classLoaderOverride = classLoader;<br>            oldStatus = <span class="hljs-built_in">dvmChangeStatus</span>(self, THREAD_NATIVE);<br>            ···<br>            version = (*func)(gDvmJni.jniVm, <span class="hljs-literal">NULL</span>);<br>            <span class="hljs-built_in">dvmChangeStatus</span>(self, oldStatus);<br>            self-&gt;classLoaderOverride = prevOverride;<br><br>            <span class="hljs-keyword">if</span> (version != JNI_VERSION_1_2 &amp;&amp; version != JNI_VERSION_1_4 &amp;&amp;<br>                version != JNI_VERSION_1_6)<br>            {<br>                ···<br>                result = <span class="hljs-literal">false</span>;<br>            } <span class="hljs-keyword">else</span> {<br>                ···<br>            }<br>        }<br><br>        <span class="hljs-keyword">if</span> (result)<br>            pNewEntry-&gt;onLoadResult = kOnLoadOkay;<br>        <span class="hljs-keyword">else</span><br>            pNewEntry-&gt;onLoadResult = kOnLoadFailed;<br><br>        pNewEntry-&gt;onLoadThreadId = <span class="hljs-number">0</span>;<br><br>        <span class="hljs-comment">// 释放锁资源 </span><br>        <span class="hljs-built_in">dvmLockMutex</span>(&amp;pNewEntry-&gt;onLoadLock);<br>        <span class="hljs-built_in">pthread_cond_broadcast</span>(&amp;pNewEntry-&gt;onLoadCond);<br>        <span class="hljs-built_in">dvmUnlockMutex</span>(&amp;pNewEntry-&gt;onLoadLock);<br>        <span class="hljs-keyword">return</span> result;<br>    }<br>}<br></code></pre></td></tr></tbody></table></figure>

<!-- ### native 方法调用原理
- 虚拟机调用一个方法时，发现如果这是一个 native 方法，则使用 Method 对象中的nativeFunc 函数指针对象调用。

``dalvik2/vm/interp/Stack.cpp``:
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs cpp"><span class="hljs-function">Object* <span class="hljs-title">dvmInvokeMethod</span><span class="hljs-params">(Object* obj, <span class="hljs-type">const</span> Method* method,</span></span><br><span class="hljs-params"><span class="hljs-function">    ArrayObject* argList, ArrayObject* params, ClassObject* returnType,</span></span><br><span class="hljs-params"><span class="hljs-function">    <span class="hljs-type">bool</span> noAccessCheck)</span></span><br><span class="hljs-function"></span>&#123;<br>    ···<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">dvmIsNativeMethod</span>(method)) &#123;<br>        <span class="hljs-built_in">TRACE_METHOD_ENTER</span>(self, method);<br>        (*method-&gt;nativeFunc)((u4*)self-&gt;interpSave.curFrame, &amp;retval, method, self);<br>        <span class="hljs-built_in">TRACE_METHOD_EXIT</span>(self, method);<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-built_in">dvmInterpret</span>(self, method, &amp;retval);<br>    &#125;<br>    ···<br>&#125;<br>``` --&gt;<br><br>## CMake 构建 NDK 项目<br><br>&gt; CMake 是一个开源的跨平台工具系列，旨在构建，测试和打包软件，从 Android Studio <span class="hljs-number">2.2</span> 开始，Android Sudio 默认地使用 CMake 与<br>&gt; Gradle 搭配使用来构建原生库。<br><br>启动方式只需要在 ``app/build.gradle`` 中添加相关：<br><br>```groovy<br>android &#123;<br>    · · ·<br>    defaultConfig &#123;<br>        · · ·<br>        externalNativeBuild &#123;<br>            cmake &#123;<br>                cppFlags <span class="hljs-string">&quot;&quot;</span><br>            &#125;<br>        &#125;<br><br>        ndk &#123;<br>            abiFilters <span class="hljs-string">&#x27;arm64-v8a&#x27;</span>, <span class="hljs-string">&#x27;armeabi-v7a&#x27;</span><br>        &#125;<br>    &#125;<br>    · · ·<br>    externalNativeBuild &#123;<br>        cmake &#123;<br>            path <span class="hljs-string">&quot;CMakeLists.txt&quot;</span><br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>然后在对应目录新建一个 <code>CMakeLists.txt</code> 文件：</p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs txt"># 定义了所需 CMake 的最低版本<br>cmake_minimum_required(VERSION 3.4.1)<br><br># add_library() 命令用来添加库<br># native-lib 对应着生成的库的名字<br># SHARED 代表为分享库<br># src/main/cpp/native-lib.cpp 则是指明了源文件的路径。<br>add_library( # Sets the name of the library.<br>        native-lib<br><br>        # Sets the library as a shared library.<br>        SHARED<br><br>        # Provides a relative path to your source file(s).<br>        src/main/cpp/native-lib.cpp)<br><br># find_library 命令添加到 CMake 构建脚本中以定位 NDK 库，并将其路径存储为一个变量。<br># 可以使用此变量在构建脚本的其他部分引用 NDK 库<br>find_library( # Sets the name of the path variable.<br>        log-lib<br><br>        # Specifies the name of the NDK library that<br>        # you want CMake to locate.<br>        log)<br><br># 预构建的 NDK 库已经存在于 Android 平台上，因此，无需再构建或将其打包到 APK 中。<br># 由于 NDK 库已经是 CMake 搜索路径的一部分，只需要向 CMake 提供希望使用的库的名称，并将其关联到自己的原生库中<br><br># 要将预构建库关联到自己的原生库<br>target_link_libraries( # Specifies the target library.<br>        native-lib<br><br>        # Links the target library to the log library<br>        # included in the NDK.<br>        $&#123;log-lib&#125;)<br>···<br></code></pre></td></tr></table></figure>

<ul>
<li><a target="_blank" rel="noopener" href="https://cmake.org/cmake/help/latest/manual/cmake-commands.7.html">CMake 命令详细信息文档</a></li>
</ul>
<h2 id="常用的-Android-NDK-原生-API"><a href="#常用的-Android-NDK-原生-API" class="headerlink" title="常用的 Android NDK 原生 API"></a>常用的 Android NDK 原生 API</h2><table>
<thead>
<tr>
<th>支持 NDK 的 API 级别</th>
<th>关键原生 API</th>
<th>包括</th>
</tr>
</thead>
<tbody><tr>
<td>3</td>
<td>Java 原生接口</td>
<td>#include &lt;jni.h&gt;</td>
</tr>
<tr>
<td>3</td>
<td>Android 日志记录 API</td>
<td>#include &lt;android&#x2F;log.h&gt;</td>
</tr>
<tr>
<td>5</td>
<td>OpenGL ES 2.0</td>
<td>#include &lt;GLES2&#x2F;gl2.h&gt;<br>#include &lt;GLES2&#x2F;gl2ext.h&gt;</td>
</tr>
<tr>
<td>8</td>
<td>Android 位图 API</td>
<td>#include &lt;android&#x2F;bitmap.h&gt;</td>
</tr>
<tr>
<td>9</td>
<td>OpenSL ES</td>
<td>#include &lt;SLES&#x2F;OpenSLES.h&gt;<br>#include &lt;SLES&#x2F;OpenSLES_Platform.h&gt;<br>#include &lt;SLES&#x2F;OpenSLES_Android.h&gt;<br>#include &lt;SLES&#x2F;OpenSLES_AndroidConfiguration.h&gt;</td>
</tr>
<tr>
<td>9</td>
<td>原生应用 API</td>
<td>#include &lt;android&#x2F;rect.h&gt;<br>#include &lt;android&#x2F;window.h&gt;<br>#include&lt;android&#x2F;native_activity.h&gt;<br>···</td>
</tr>
<tr>
<td>18</td>
<td>OpenGL ES 3.0</td>
<td>#include &lt;GLES3&#x2F;gl3.h&gt;<br>#include &lt;GLES3&#x2F;gl3ext.h&gt;</td>
</tr>
<tr>
<td>21</td>
<td>原生媒体 API</td>
<td>#include &lt;media&#x2F;NdkMediaCodec.h&gt;<br>#include &lt;media&#x2F;NdkMediaCrypto.h&gt;<br>···</td>
</tr>
<tr>
<td>24</td>
<td>原生相机 API</td>
<td>#include &lt;camera&#x2F;NdkCameraCaptureSession.h&gt;<br>#include &lt;camera&#x2F;NdkCameraDevice.h&gt;<br>···</td>
</tr>
<tr>
<td>···</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h1 id="类加载器"><a href="#类加载器" class="headerlink" title="类加载器"></a>类加载器</h1><p><img src="https://img-blog.csdn.net/20161021101447117?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" srcset="/img/loading.gif" lazyload></p>
<h2 id="双亲委托模式"><a href="#双亲委托模式" class="headerlink" title="双亲委托模式"></a>双亲委托模式</h2><p>某个特定的类加载器在接到加载类的请求时，首先将加载任务委托给父类加载器，依次递归，如果父类加载器可以完成类加载任务，就成功返回；只有父类加载器无法完成此加载任务时，才自己去加载。</p>
<p>因为这样可以避免重复加载，当父亲已经加载了该类的时候，就没有必要子 ClassLoader<br>再加载一次。如果不使用这种委托模式，那我们就可以随时使用自定义的类来动态替代一些核心的类，存在非常大的安全隐患。</p>
<h2 id="DexPathList"><a href="#DexPathList" class="headerlink" title="DexPathList"></a>DexPathList</h2><p>DexClassLoader 重载了 <code>findClass</code> 方法，在加载类时会调用其内部的 DexPathList 去加载。DexPathList 是在构造 DexClassLoader<br>时生成的，其内部包含了 DexFile。</p>
<p><code>DexPathList.java</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java">···<br><span class="hljs-keyword">public</span> Class <span class="hljs-title function_">findClass</span><span class="hljs-params">(String name)</span>&#123;<br>        <span class="hljs-keyword">for</span>(Element element:dexElements)&#123;<br>        DexFile dex=element.dexFile;<br>        <span class="hljs-keyword">if</span>(dex!=<span class="hljs-literal">null</span>)&#123;<br>        Class clazz=dex.loadClassBinaryName(name,definingContext);<br>        <span class="hljs-keyword">if</span>(clazz!=<span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-keyword">return</span> clazz;<br>        &#125;<br>        &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        ···<br></code></pre></td></tr></table></figure>


-->
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Android/" class="category-chain-item">Android</a>
  
  
    <span>></span>
    
  <a href="/categories/Android/%E7%9F%A5%E8%AF%86%E6%B1%87%E6%80%BB/" class="category-chain-item">知识汇总</a>
  
  

  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/Android/" class="print-no-link">#Android</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>Android扩展知识点</div>
      <div>http://virogu.github.io/2023/08/24/docs/android/zhi-shi-hui-zong/android-kuo-zhan-zhi-shi-dian/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>未知</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2023年8月24日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2023/08/24/docs/c/c-zhi-shi-dian-hui-zong/" title="C  知识点汇总">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">C  知识点汇总</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2023/08/24/docs/android/zhi-shi-hui-zong/android-zhi-shi-dian-hui-zong/" title="Android知识点汇总">
                        <span class="hidden-mobile">Android知识点汇总</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
  
  
    <article id="comments" lazyload>
      
  <div id="valine"></div>
  <script type="text/javascript">
    Fluid.utils.loadComments('#valine', function() {
      Fluid.utils.createScript('https://lib.baomitu.com/valine/1.5.1/Valine.min.js', function() {
        var options = Object.assign(
          {"appId":"V9v3WDm9N49RSD9H2LQ6evJF-gzGzoHsz","appKey":"vnpaffWoXVwxIK81KYqPUYqg","path":"window.location.pathname","placeholder":"我有话要说 ~","avatar":"robohash","meta":["nick","mail","link"],"requiredFields":[],"pageSize":10,"lang":"zh-CN","highlight":true,"recordIP":true,"serverURLs":"","emojiCDN":null,"emojiMaps":null,"enableQQ":true,"visitor":true},
          {
            el: "#valine",
            path: window.location.pathname
          }
        )
        new Valine(options);
        Fluid.utils.waitElementVisible('#valine .vcontent', () => {
          var imgSelector = '#valine .vcontent img:not(.vemoji)';
          Fluid.plugins.imageCaption(imgSelector);
          Fluid.plugins.fancyBox(imgSelector);
        })
      });
    });
  </script>
  <noscript>Please enable JavaScript to view the comments</noscript>


    </article>
  


          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
      <span>Copyright&nbsp;&copy;2023</span>&nbsp;
<a href="https://github.com/virogu" target="_blank" rel="nofollow noopener"><span>Virogu</span></a>
<span>&nbsp;|&nbsp;</span>
<a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
<i class="iconfont icon-love"></i>
<a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a>

    </div>
  
  
    <div class="statistics">
  
  

  
    
      <span id="busuanzi_container_site_pv" style="display: none">
        总访问量 
        <span id="busuanzi_value_site_pv"></span>
         次
      </span>
    
    
      <span id="busuanzi_container_site_uv" style="display: none">
        总访客数 
        <span id="busuanzi_value_site_uv"></span>
         人
      </span>
    
    
  
</div>

  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>





  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>

  <script defer src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
